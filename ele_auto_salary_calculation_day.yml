ele_auto_salary_env:
  context_defaults:
    platform_code: elem
    play_on_dask_cluster: true
    delay_compute: true
    sync_result_from_cluster: true
    dask_client_set_as_default: true
    debug: true
    cluster_client_address: 'tcp://172.31.54.193:8786'
  pre_load_dataset:
    - std_qplus_vendor_dc_map
    - ele_month_58_std
    - ele_month_59_std
    - ele_month_57_std
    - ele_month_33_std
    - ele_month_37_std

  #  预计算的数据集
  play:
    # === 欺诈单表
    - name: ele_month_37_std_cheat
      sync_result: true
      keep_result: true
      cooks:
        - fetch_dataset:
            dataset_type_code: ele_month_37_std
            dataset_cate: std
            ignore_null_error: true
            month_range: true
            month_delta: -1
            month_offset: 0
            columns: [ 运单号,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: 欺诈单
        - rename_cols:
            - 业务类型: 欺诈单
        - str_strip_column:
            column: 运单号


    # 运单详情上个月月末两天的数据
    - name: ele_month_57_std_last_month_two_days
      sync_result: true
      keep_result: true
      cooks:
        - fetch_dataset:
            dataset_type_code: ele_month_57_std
            dataset_cate: std
            month_offset: -1
            ignore_null_error: true
            columns: [ 站点ID,骑手ID, 运单送达时间, 运单号, 用户评价状态 ]

        - when_empty_fetch_dataset:
            dataset_type_code: ele_day_4_std
            dataset_cate: std
            month_offset: -1
            ignore_null_error: true
            columns: [ 站点ID,骑手ID, 运单送达时间, 运单号 ]

        - convert_month_day_time_column:
            src_column: 运单送达时间
            day_column: 运单送达日期
        # 获取算薪月上月的最后两天数据的
        - run_py:
            - |
              date = df[u'运单送达日期'] % 100
              df[u'本月总天数'] = date.max() % 100
              result = df
        - df_select:
            - '[运单送达日期] % 100  > [本月总天数] - 2'


    # === 基础单量 - 使用原有表计算
    - name: ele_month_58_std_complete_order_single_mini
      sync_result: true
      keep_result: true
      cooks:
        # 完成单量
        - use_df:
            key: ele_month_58_std
            rename:
              账单时间: 日期
        - df_select:
            - '[业务类型] == @p1 & [详情] in @p2'
            - p1: 配送收入
              p2: [差评,完成单,完成单-超时]
        # 增加时段标签，每半小时为一个时间段
        - add_cols:
            - time_segment_no: -1
        - run_py:
            - |
              df['time_segment_no'] = (df[u'业务交易时间_time'] % 100 + df[u'业务交易时间_time'].floordiv(100) * 60).floordiv(30) + 1
              result = df
        - df_to_int:
            - time_segment_no
        # 匹配欺诈单
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_37_std_cheat
        - stash_push_df: [ ]
        - stash_join_df:
            on: 运单号
            how: right
            drop_stash: true
        - df_select:
            - '[欺诈单] != @p1'
            - p1: 欺诈单

        - push_dataset:
            key: ele_month_58_std_mini
        - use_df:
            key: ele_month_58_std_mini
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: [ 时段补贴,重量补贴,距离补贴,金额,基础配送费 ]
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_58_std_mini
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 完成单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: outer
            drop_stash: true


    # 评价单
    - name: ele_assess_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        # 服务奖惩的评价中的好评
        - use_df:
            key: ele_month_59_std
            columns: [骑手ID,运单号,评价等级,评价来源,评价日期,申述状态,判定状态]
        - df_select:
            - '([评价等级] == @p1) | ([评价等级] == @p2)'
            - p1: 非常满意
              p2: 吐槽
        - drop_duplicates:
            subset: [运单号]
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - push_dataset:
            key: comment_assess_order
        # 运单详情中的好评单
        - use_df:
            key: ele_month_57_std
            columns: [站点ID, 运单送达时间, 运单号]
        - stash_push_df: []
        - use_df:
            key: ele_month_57_std_last_month_two_days
            columns: [站点ID, 运单送达时间, 运单号]
        - stash_push_df: []
        - stash_concat_df:
            drop_stash: true
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - stash_push_df: []
        - use_df:
            key: comment_assess_order
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - stash_push_df: []
        - stash_join_df:
            on: 运单号
            how: left
            drop_stash: true
        - run_py:
            - |
              df[u'评价间隔_dt'] = df[u'评价日期'] - df[u'运单送达时间']
              df[u'评价间隔_res'] = df[u'评价间隔_dt'].dt.days * 24 + df[u'评价间隔_dt'].dt.seconds / 3600
              result = df
        - stash_push_df: []
        # ！！！大坑预警：使用的评价日期
        - convert_month_day_time_column:
            src_column: 评价日期
            day_column: 日期


    # 好评-评价
    - name: ele_assess_good_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_assess_order_monthly_day
            columns: [骑手ID,站点ID,日期,运单号,评价等级,评价来源,评价日期,评价间隔_dt,评价间隔_res]
        - df_select:
            - '[评价等级] == @p1'
            - p1: 非常满意
        - push_dataset:
            key: ele_assess_good_order_monthly_mini
        # 计算所有评价
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 好评单量-评价
        - df_reset_index: []
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_good_order_monthly_mini
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 好评单量-评价-24h以下
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_good_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 好评单量-评价-24h-48h
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_good_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 好评单量-评价-48h-72h
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_good_order_monthly_all_day
        # 计算用户评价
        - use_df:
            key: ele_assess_good_order_monthly_mini
        - df_select:
            - '[评价来源] == @p1'
            - p1: 用户
        - push_dataset:
            key: ele_assess_good_order_monthly_cust
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(用户)
        - df_reset_index: []
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_cust
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(用户)-24h以下
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_cust
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(用户)-24h-48h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_cust
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(用户)-48h-72h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_good_order_monthly_cust_day
        - pop_dataset:
            key: ele_assess_good_order_monthly_cust
        # 计算商家评价
        - use_df:
            key: ele_assess_good_order_monthly_mini
        - df_select:
            - '[评价来源] == @p1'
            - p1: 商家
        - push_dataset:
            key: ele_assess_good_order_monthly_business
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(商家)
        - df_reset_index: []
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_business
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(商家)-24h以下
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_business
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(商家)-24h-48h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_business
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 好评单量-评价(商家)-48h-72h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_good_order_monthly_business_day
        - pop_dataset:
            key: ele_assess_good_order_monthly_business
        - pop_dataset:
            key: ele_assess_good_order_monthly_mini
        - use_df:
            key: ele_assess_good_order_monthly_all_day
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_cust_day
        - stash_push_df: []
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_good_order_monthly_business_day
        - stash_push_df: []
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true


    # 差评-评价
    - name: ele_assess_bad_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_assess_order_monthly_day
            columns: [骑手ID,站点ID,日期,运单号,评价等级,评价来源,评价日期,评价间隔_dt,评价间隔_res]
        - df_select:
            - '[评价等级] == @p1'
            - p1: 吐槽
        - push_dataset:
            key: ele_assess_bad_order_monthly_mini
        # 计算所有评价
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-评价
        - df_reset_index: []
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_bad_order_monthly_mini
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-评价-24h以下
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_bad_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-评价-24h-48h
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_assess_bad_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-评价-48h-72h
        - df_reset_index: []
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_bad_order_monthly_all_day
        # 计算用户评价
        - use_df:
            key: ele_assess_bad_order_monthly_mini
        - df_select:
            - '[评价来源] == @p1'
            - p1: 用户
        - push_dataset:
            key: ele_assess_bad_order_monthly_cust
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(用户)
        - df_reset_index: []
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_cust
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(用户)-24h以下
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_cust
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(用户)-24h-48h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_cust
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(用户)-48h-72h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_bad_order_monthly_cust_day
        - pop_dataset:
            key: ele_assess_bad_order_monthly_cust
        # 计算商家评价
        - use_df:
            key: ele_assess_bad_order_monthly_mini
        - df_select:
            - '[评价来源] == @p1'
            - p1: 商家
        - push_dataset:
            key: ele_assess_bad_order_monthly_business
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(商家)
        - df_reset_index: []
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_business
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(商家)-24h以下
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_business
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(商家)-24h-48h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_business
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 差评单量-评价(商家)-48h-72h
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_assess_bad_order_monthly_business_day
        - pop_dataset:
            key: ele_assess_bad_order_monthly_business
        - pop_dataset:
            key: ele_assess_bad_order_monthly_mini
        - use_df:
            key: ele_assess_bad_order_monthly_all_day
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_cust_day
        - stash_push_df: []
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_assess_bad_order_monthly_business_day
        - stash_push_df: []
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true


    # === 停用 === 好评单-运单详情 就在我写完以后不到5分钟 他们说不用了 对 不用了
#    - name: ele_order_good_order_monthly_day
#      sync_result: true
#      keep_result: true
#      cooks:
#        - use_df:
#            key: ele_month_59_std
#            columns: [骑手ID,运单号,评价等级,评价日期]
#        - df_select:
#            - '[评价等级] == @p1'
#            - p1: 非常满意
#        - drop_duplicates:
#            subset: [运单号]
#        - dask_persist_compute:
#            sync_compute: true
#            chunk_size: 5000
#        - push_dataset:
#            key: comment_assess_order
#        # 运单详情中的好评单
#        - use_df:
#            key: ele_month_57_std
#            columns: [站点ID, 运单送达时间, 运单号, 用户评价状态]
#        - df_select:
#            - '[用户评价状态] == @p1'
#            - p1: 非常满意
#        - stash_push_df: []
#        - use_df:
#            key: ele_month_57_std_last_month_two_days
#            columns: [站点ID, 运单送达时间, 运单号, 用户评价状态]
#        - df_select:
#            - '[用户评价状态] == @p1'
#            - p1: 非常满意
#        - stash_push_df: []
#        - stash_concat_df:
#            drop_stash: true
#        - dask_persist_compute:
#            sync_compute: true
#            chunk_size: 5000
#        - stash_push_df: []
#        - use_df:
#            key: comment_assess_order
#        - dask_persist_compute:
#            sync_compute: true
#            chunk_size: 5000
#        - stash_push_df: []
#        - stash_join_df:
#            on: 运单号
#            how: right
#            drop_stash: true
#        - run_py:
#            - |
#              df[u'评价间隔_dt'] = df[u'评价日期'] - df[u'运单送达时间']
#              df[u'评价间隔_res'] = df[u'评价间隔_dt'].dt.days * 24 + df[u'评价间隔_dt'].dt.seconds / 3600
#              result = df
#        - convert_month_day_time_column:
#            src_column: 运单送达时间
#            day_column: 日期
#        - push_dataset:
#            key: ele_order_good_order_monthly_day_mini
#        - df_groupby:
#            by: [ 骑手ID,日期 ]
#        - df_count:
#            column: 运单号
#            rename: 好评单量-评价
#        - df_reset_index: [ ]
#        - stash_push_df: [ ]
#        - use_df:
#            key: ele_order_good_order_monthly_day_mini
#        - df_select:
#            - '[评价间隔_res] < @p1'
#            - p1: 24
#        - df_groupby:
#            by: [ 骑手ID,日期 ]
#        - df_count:
#            column: 运单号
#            rename: 好评单量-评价-24h以下
#        - df_reset_index: [ ]
#        - stash_push_df: [ ]
#        - stash_join_df:
#            on: [ 骑手ID,日期 ]
#            how: right
#            drop_stash: true
#        - stash_push_df: [ ]
#        - use_df:
#            key: ele_order_good_order_monthly_day_mini
#        - df_select:
#            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
#            - p1: 48
#              p2: 24
#        - df_groupby:
#            by: [ 骑手ID,日期 ]
#        - df_count:
#            column: 运单号
#            rename: 好评单量-评价-24h-48h
#        - df_reset_index: [ ]
#        - stash_push_df: [ ]
#        - stash_join_df:
#            on: [ 骑手ID,日期 ]
#            how: right
#            drop_stash: true
#        - stash_push_df: [ ]
#        - use_df:
#            key: ele_order_good_order_monthly_day_mini
#        - df_select:
#            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
#            - p1: 72
#              p2: 48
#        - df_groupby:
#            by: [ 骑手ID,日期 ]
#        - df_count:
#            column: 运单号
#            rename: 好评单量-评价-48h-72h
#        - df_reset_index: [ ]
#        - stash_push_df: [ ]
#        - stash_join_df:
#            on: [ 骑手ID,日期 ]
#            how: right
#            drop_stash: true


    # 异常单-差评
    - name: ele_anomaly_bad_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_33_std
        - df_select:
            - '([问题单类型] == @p1) | ([问题单类型] == @p2)'
            - p1: 差评
              p2: 差评(星巴克)
        - stash_push_df: []
        - use_df:
            key: ele_assess_order_monthly_day
            columns: [ 骑手ID,站点ID,日期,运单号,评价等级,评价间隔_dt,评价间隔_res ]
        - df_select:
            - '[评价等级] == @p1'
            - p1: 吐槽
        - stash_push_df: []
        - stash_join_df:
            on: 运单号
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_anomaly_bad_order_monthly_mini
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-问题单
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_anomaly_bad_order_monthly_mini
        - df_select:
            - '[评价间隔_res] < @p1'
            - p1: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-问题单-24h以下
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_anomaly_bad_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 48
              p2: 24
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-问题单-24h-48h
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_anomaly_bad_order_monthly_mini
        - df_select:
            - '([评价间隔_res] < @p1) & ([评价间隔_res] >= @p2)'
            - p1: 72
              p2: 48
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 差评单量-问题单-48h-72h
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true


    # 各种超时
    - name: ele_overtime_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_57_std
            columns: [骑手ID,站点ID,运单送达时间,month,骑手T超时时长,运单号]
        - df_select:
            - '[骑手T超时时长] != @p1'
            - p1: ——
        - convert_month_day_time_column:
            src_column: 运单送达时间
            day_column: 日期
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: re.match(u'超时(.*)分钟', x, ).group(1) if re.match(u'超时(.*)分钟', x, ) else u'0'
              df[u'超时T分钟'] = df[u'骑手T超时时长'].apply(fn)
              result = to_dd(df)
        - df_to_int:
            - 超时T分钟
        - push_dataset:
            key: ele_overtime_order_monthly_day_order_mini
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情
        - df_reset_index: []
        - stash_push_df: []
        - use_df:
            key: ele_overtime_order_monthly_day_order_mini
        - df_select:
            - '([超时T分钟] >= @p1) & ([超时T分钟] < @p2)'
            - p1: 12
              p2: 15
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情-T12-T15
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_overtime_order_monthly_day_order_mini
        - df_select:
            - '([超时T分钟] >= @p1) & ([超时T分钟] < @p2)'
            - p1: 15
              p2: 30
        - df_groupby:
            by: [骑手ID,日期,站点ID]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情-T15-T30
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [骑手ID,日期]
            how: right
            drop_stash: true
        - stash_push_df: []
        - use_df:
            key: ele_overtime_order_monthly_day_order_mini
        - df_select:
            - '([超时T分钟] >= @p1) & ([超时T分钟] < @p2)'
            - p1: 30
              p2: 45
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情-T30-T45
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_overtime_order_monthly_day_order_mini
        - df_select:
            - '([超时T分钟] >= @p1) & ([超时T分钟] < @p2)'
            - p1: 45
              p2: 60
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情-T45-T60
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - stash_push_df: [ ]
        - use_df:
            key: ele_overtime_order_monthly_day_order_mini
        - df_select:
            - '[超时T分钟] < @p1'
            - p1: 12
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 超时单量-运单详情-T12以下
        - df_reset_index: []
        - stash_push_df: []
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: right
            drop_stash: true
        - pop_dataset:
            key: ele_overtime_order_monthly_day_order_mini



    # 虚假配送单量
    - name: ele_problem_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_57_std
            columns: [ 骑手ID,站点ID,运单送达时间,month,骑手T超时时长,运单号 ]
        - convert_month_day_time_column:
            src_column: 运单送达时间
            day_column: 日期
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_33_std
        - df_head: [ ]
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 运单号 ]
            how: left
            drop_stash: true
        - dask_persist_compute:
            sync_compute: true
            chunk_size: 5000
        - push_dataset:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 虚假配送
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 虚假配送单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 虚假配送(评价)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 虚假配送(评价)单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 虚假配送(投诉)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 虚假配送(投诉)单量
        - stash_push_df: [ ]
        - use_df:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 配送原因取消
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 配送原因取消单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 配送原因取消(星巴克)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 配送原因取消(星巴克)单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_problem_order_monthly_day_mini
        - df_select:
            - '[问题单类型] == @p1'
            - p1: 违规送达
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 违规送达单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: outer
            drop_stash: true
        - pop_dataset:
            key: ele_problem_order_monthly_day_mini


    # 罚款单量、金额
    - name: ele_fine_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_37_std
            columns: [运单号, 账单类型]
        - df_select:
            - '[账单类型] == @p1'
            - p1: '申诉返款'
        - df_rename_columns:
            - 账单类型: 申诉返款
        - stash_push_df: []
        - use_df:
            key: ele_month_37_std
            rename:
                账单时间: 日期
        - df_select:
            - '[账单类型] == @p1'
            - p1: '违规扣款'
        - stash_push_df: []
        - stash_join_df:
            on: [运单号]
            how: left
            drop_stash: true
        - df_select:
            - '[申诉返款] != @p1'
            - p1: '申诉返款'
        - push_dataset:
            key: ele_fine_order_monthly_day_mini

        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '索赔'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 金额
            rename: 索赔金额
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '索赔'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 索赔单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '抽检'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 金额
            rename: 抽检金额
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '抽检'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 抽检单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '投诉'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 金额
            rename: 投诉金额-违规扣款
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_fine_order_monthly_day_mini
            columns: [ 运单号, 账单类型,日期,骑手ID,站点ID,金额,业务类型 ]
        - df_select:
            - '[业务类型] == @p1'
            - p1: '投诉'
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 投诉单量-违规扣款
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [骑手ID,日期,站点ID]
            how: outer
            drop_stash: true
        - pop_dataset:
            key: ele_fine_order_monthly_day_mini


    # 在线时长 ！！！记着替换数据源 ！！！
    - name: ele_online_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_48
            columns: [骑手ID,meta_day,团队ID,全天在线时长]
            rename:
                meta_day: 日期
                团队ID: 站点ID
        - df_fillna:
            columns: [全天在线时长]
            value: '-'
        - run_py:
            - |
                df = to_df(df)
                fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
                df[u'全天在线时长-分钟'] = df[u'全天在线时长'].apply(fn)
                result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 全天在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,凌晨夜宵在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 凌晨夜宵在线时长 ]
            value: '-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'凌晨夜宵在线时长-分钟'] = df[u'凌晨夜宵在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 凌晨夜宵在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,早餐在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 早餐在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'早餐在线时长-分钟'] = df[u'早餐在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 早餐在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,午高峰在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 午高峰在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'午高峰在线时长-分钟'] = df[u'午高峰在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 午高峰在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,下午在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 下午在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'下午在线时长-分钟'] = df[u'下午在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 下午在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,晚高峰在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 晚高峰在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'晚高峰在线时长-分钟'] = df[u'晚高峰在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 晚高峰在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,晚间在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 晚间在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'晚间在线时长-分钟'] = df[u'晚间在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 晚间在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_48
            columns: [ 骑手ID,meta_day,团队ID,晚间夜宵在线时长 ]
            rename:
              meta_day: 日期
              团队ID: 站点ID
        - df_fillna:
            columns: [ 晚间夜宵在线时长 ]
            value: u'-'
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: (int(re.match(u'(.*)小时(.*)分钟', x, ).group(1)) * 60 + int(re.match(u'(.*)小时(.*)分钟', x, ).group(2))) if re.match(u'(.*)小时(.*)分钟', x, ) else 0
              df[u'晚间夜宵在线时长-分钟'] = df[u'晚间夜宵在线时长'].apply(fn)
              result = to_dd(df)
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 晚间夜宵在线时长-分钟
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: outer
            drop_stash: true


    # 各种奖励 ！！！记着替换数据源 ！！！
    - name: ele_reward_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_56
            columns: [ 奖励运单,奖励类型,奖励金额 ]
            rename:
              奖励运单: 运单号
        - run_py:
            - |
              df = to_df(df)
              fn = lambda x: float(re.match(u'(.*) 元', x, ).group(1)) if re.match(u'(.*) 元', x, ) else 0.0
              df[u'奖励金额-元'] = df[u'奖励金额'].apply(fn)
              result = to_dd(df)
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_57_std
            columns: [ 骑手ID,运单送达时间,站点ID,运单号 ]
        - convert_month_day_time_column:
            src_column: 运单送达时间
            day_column: 日期
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 运单号 ]
            how: right
            drop_stash: true
        - push_dataset:
            key: ele_reward_order_monthly_day_mini
        - use_df:
            key: ele_reward_order_monthly_day_mini
        - df_select:
            - '[奖励类型] == @p1'
            - p1: 价格奖励
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 奖励金额-元
            rename: 价格奖励
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_reward_order_monthly_day_mini
        - df_select:
            - '[奖励类型] == @p1'
            - p1: 距离奖励
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 奖励金额-元
            rename: 距离奖励
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_reward_order_monthly_day_mini
        - df_select:
            - '[奖励类型] == @p1'
            - p1: 重量奖励
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 奖励金额-元
            rename: 重量奖励
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_reward_order_monthly_day_mini
        - df_select:
            - '[奖励类型] == @p1'
            - p1: 天气奖励
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 奖励金额-元
            rename: 天气奖励
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_reward_order_monthly_day_mini
        - df_select:
            - '[奖励类型] == @p1'
            - p1: 时段奖励
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_sum:
            column: 奖励金额-元
            rename: 时段奖励
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - stash_join_df:
            on: [ 骑手ID,日期,站点ID ]
            how: outer
            drop_stash: true


    # 各种运单详情相关-淘鲜达单量、即时单量、预订单量、盒马单量 ！！！记着替换数据源 ！！！
    - name: ele_reward_order_monthly_day
      sync_result: true
      keep_result: true
      cooks:
        - use_df:
            key: ele_month_57
            columns: [ 骑手id, 团队ID,运单号,运单送达时间,运单类型,标品类型 ]
        - convert_month_day_time_column:
            src_column: 运单送达时间
            day_column: 日期
        - push_dataset:
            key: ele_month_57_mini

        - df_select:
            - '[运单类型] == @p1'
            - p1: 即时单
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 即时单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_57_mini
        - df_select:
            - '[运单类型] == @p1'
            - p1: 预订单
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 预订单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]

        - use_df:
            key: ele_month_57_mini
        - df_select:
            - '[标品类型] == @p1'
            - p1: 盒马
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 盒马单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_57_mini
        - df_select:
            - '[标品类型] == @p1'
            - p1: 淘鲜达
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 淘鲜达单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
        - use_df:
            key: ele_month_57_mini
        - df_select:
            - '[标品类型] == @p1'
            - p1: 淘鲜达
        - df_groupby:
            by: [ 骑手ID,日期,站点ID ]
        - df_count:
            column: 运单号
            rename: 淘鲜达单量
        - df_reset_index: [ ]
        - stash_push_df: [ ]
